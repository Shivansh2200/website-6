<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Use case 1 - Tungsten Fabric Carbide Evaluation Guide</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/text.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Tungsten Fabric Carbide Evaluation Guide</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Home</a>
                            </li>
                            <li class="active">
                                <a href="./">Use case 1</a>
                            </li>
                            <li >
                                <a href="../use_case_2/">Use case 2</a>
                            </li>
                            <li >
                                <a href="../use_case_3/">Use case 3</a>
                            </li>
                            <li >
                                <a href="../use_case_4/">Use case 4</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../use_case_2/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#use-case-1-basic-app-connectivity-through-kubernetes-services">Use case 1: Basic app connectivity through Kubernetes' Services</a></li>
            <li><a href="#when-would-i-care">When would I care?</a></li>
            <li><a href="#deployments">Deployments</a></li>
            <li><a href="#services">Services</a></li>
            <li><a href="#sample-apps-deployments-and-services">Sample app's Deployments and Services</a></li>
            <li><a href="#cleanup">Cleanup</a></li>
            <li><a href="#recap-and-whats-next">Recap and what's next</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="use-case-1-basic-app-connectivity-through-kubernetes-services">Use case 1: Basic app connectivity through Kubernetes' Services</h2>
<p>This is the most <a href="https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/">basic and fundamental functionality</a> that all Kubernetes CNI plugins provide. Application Pods need to be able to talk to each other, and Kubernetes Services are the way to ensure that it is possible with Pods coming and going with time to support application scale and availability.</p>
<h3 id="when-would-i-care">When would I care?</h3>
<p>All major CNI plugins provide basic Pod to Pod connectivity, as well as some of the Service types, such as <code>ClusterIP</code>.</p>
<p>In addition to that, Tungsten Fabric comes with out of the box support of Service type <code>LoadBalancer</code>. When running on AWS, using <code>LoadBalancer</code> Service in your manifest creates a public-facing AWS ELB, making your application available from the Internet in one step.</p>
<p>This also means you can use the Kubernetes deployment manifest for your application unchanged in all places where Tungsten Fabric with Kubernetes is available - on premises and in all major public clouds.</p>
<h3 id="deployments">Deployments</h3>
<p>When you create a Deployment, a CNI works in concert with Kubernetes to allocate network IP addresses for each of your application Pods, and "wire up" each pod to the cluster network.</p>
<blockquote>
<p>Note: most CNIs work by creating an <code>overlay network</code> that in most cases is contained within the boundaries of a single Kubernetes cluster. As the result, Pods in different clusters cannot communicate directly.</p>
<p>While we will not cover multi-cluster scenarios in this document, Tungsten Fabric is capable of supporting such configurations. A single installation of Tungsten Fabric can serve multiple Kubernetes clusters at the same time. In such scenario Pods from different clusters can communicate with each other directly, even if Kubernetes clusters themselves are in different locations.</p>
</blockquote>
<h3 id="services">Services</h3>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Services</a> in Kubernetes are "an abstract way to expose an application running on a set of Pods". In most cases, a Service is a simple Round-Robin Load Balancer. It has a Virtual IP address ("VIP") for receiving network requests, and a zero or more Endpoint IP addresses that it will forward these requests to.</p>
<p>In most cases a Service will automatically discover Endpoint IP addresses that belong to the application Pods by looking for matching labels (called "Selectors") on running Pods.</p>
<h3 id="sample-apps-deployments-and-services">Sample app's Deployments and Services</h3>
<p>Make sure you're on the sandbox control node, logged in as root, and in the correct directory:</p>
<pre><code class="bash"># Make sure we're root
whoami | grep root || sudo -s

# Change to the manifests directory
cd /home/centos/yelb/deployments/platformdeployment/Kubernetes/yaml
</code></pre>

<p>Review the <code>cnawebapp-loadbalancer.yaml</code> file, looking for the sections that start with <code>Kind: Deployment</code> and <code>Kind: Service</code></p>
<pre><code class="bash">less cnawebapp-loadbalancer.yaml
</code></pre>

<p>(Use arrows / PgUp / PgDn to navigate; press <code>q</code> to exit)</p>
<p>Note that:</p>
<ul>
<li><code>spec.template.spec.containers.ports.containerPort</code> in Deployments shows what TCP port a Pod will listen to;</li>
<li><code>spec.ports</code> in Services shows what port a Service's VIP will be listening to;</li>
<li><code>spec.selector</code> in Services shows what labels on Pods a Service will look for to send traffic to.</li>
</ul>
<p>Next, let's deploy our app and see what happens:</p>
<pre><code class="bash">kubectl create -f cnawebapp-loadbalancer.yaml
</code></pre>

<p>This will create the following application topology:</p>
<p><img alt="alt_text" src="../images/image4.png" title="image_tooltip" /></p>
<p>If the application deploys without errors, we should be able to see that:</p>
<p>All Pods have their own IP address and are listening on their respective ports:</p>
<pre><code class="text">kubectl get pods -o wide
NAME                             READY     STATUS    RESTARTS   AGE       IP              NODE
redis-server-5786bc9958-mkm6s    1/1       Running   0          9m        10.47.255.247   ip-172-25-1-190.us-west-1.compute.internal
yelb-appserver-7975bf6fb-xvzgh   1/1       Running   0          9m        10.47.255.248   ip-172-25-1-190.us-west-1.compute.internal
yelb-db-ccd4bd9f5-9pt9m          1/1       Running   0          9m        10.47.255.249   ip-172-25-1-79.us-west-1.compute.internal
yelb-ui-5cd947475f-dsvbd         1/1       Running   0          9m        10.47.255.250   ip-172-25-1-79.us-west-1.compute.internal
</code></pre>

<p>All Services have a VIP and a port they're listening on:</p>
<pre><code class="text">kubectl get svc
NAME             TYPE           CLUSTER-IP       EXTERNAL-IP        PORT(S)        AGE
kubernetes       ClusterIP      10.96.0.1        &lt;none&gt;             443/TCP        4h
redis-server     ClusterIP      10.103.111.102   &lt;none&gt;             6379/TCP       9m
yelb-appserver   ClusterIP      10.109.212.183   &lt;none&gt;             4567/TCP       9m
yelb-db          ClusterIP      10.96.201.173    &lt;none&gt;             5432/TCP       9m
yelb-ui          LoadBalancer   10.108.170.55    aa01af9988cc3...   80:32393/TCP   9m
</code></pre>

<p>All Services have discovered their respective Endpoints:</p>
<pre><code class="text">kubectl get ep
NAME             ENDPOINTS            AGE
kubernetes       172.25.1.105:6443    4h
redis-server     10.47.255.247:6379   10m
yelb-appserver   10.47.255.248:4567   10m
yelb-db          10.47.255.249:5432   10m
yelb-ui          10.47.255.250:80     10m
</code></pre>

<p>Since Tungsten Fabric provides support for Kubernetes Service type <code>LoadBalancer</code>, we should now be able to connect to our application from the Internet. Let's find out what the public DNS name for our load balancer is:</p>
<pre><code class="text"># kubectl get svc yelb-ui -o wide
NAME      TYPE           CLUSTER-IP      EXTERNAL-IP                                                               PORT(S)        AGE       SELECTOR
yelb-ui   LoadBalancer   10.108.170.55   aa01af9988cc311e9badf06b57ebf630-1452353610.us-west-1.elb.amazonaws.com   80:32393/TCP   11m       app=yelb-ui,tier=frontend
</code></pre>

<p>We can see that our app is available on <code>aa01af9988cc311e9badf06b57ebf630-1452353610.us-west-1.elb.amazonaws.com</code>, so let's check it by pointing our web browser to it:</p>
<p><img alt="alt_text" src="../images/image11.png" title="image_tooltip" /></p>
<p>It worked!</p>
<h3 id="cleanup">Cleanup</h3>
<p>Once you've played with the app for a moment or two, feel free to undeploy it:</p>
<pre><code class="bash">kubectl delete -f cnawebapp-loadbalancer.yaml
</code></pre>

<h3 id="recap-and-whats-next">Recap and what's next</h3>
<p>In this Use Case, we've got our sample application deployed and available from the Internet using Tungsten Fabric Kubernetes CNI plugin and integration with AWS' Elastic Load Balancing.</p>
<p>Our sample application is on the web. If this is all we wanted - we are done. However, if we need things like SSL offload or want to send incoming requests to different application components based on HTTP host and/or path, we will need to use Kubernetes Ingress. The Use Case 2 covers this scenario.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
